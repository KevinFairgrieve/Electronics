= RC Electronics
Wilhelm Meier <wilhelm.wm.meier@googlemail.com>
:toc:
:toclevels: 4
:numbered:
:toc-placement!:
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

:ddir: https://wimalopaan.github.io/Electronics
:rcb: {ddir}/rc/boards

[NOTE]
--
This page and the accompanying repositories are mostly for my rc (radio controlled models) electronics including EdgeTx/OpenTx addons, LUA-scripting, videos, and more.
--

toc::[]

image::images/zfcf.jpg[width=50%]

== Foreword

[NOTE]
.To the german readers
--
Die alte Seite ist noch (und bleibt auch) als <<Old.adoc#, Old.adoc>> verfügbar.
--

== ExpressLRS

=== ExpressLRS for short range radio control

https://www.expresslrs.org[ExpressLRS] (ELRS) is a long range link for radio controlled models / machinery of all kind.
Obviously it has some advantages over some other commercial rc-links like AFHDS2A, Hott or ACCST, ...

ExpressLRS is:

* open-source (software and hardware)
* low-latency / high packet-rate
* using open (well-documented) CRSF protocol (https://github.com/crsf-wg/crsf[working group])
* extremely long range

Together with https://edgetx.org[EdgeTx] (Open-Source radio transmitter operating system) one has a extremely powerful system 
at hand to control and monitor all kind of models or machinery from remote. And the whole system (but the handset) now is open-source: 
there are no limits in extending the system.

But ELRS is not limited to its long-range capability, that makes it useful for all kind of flying machinery (planes, helicopters, drones, ...).
ELRS is as well suited for short-range radio control of boats, cars, crawlers, stationary-models (e.g. cranes, ...).

The most appealing features of ELRS with respect to short-range radio-control of models are:

* extensibility due the flexibility of the CRSF protocol, mainly on the model side (after the receiver)
* low-latency / high packet-rate for new kinds of features (e.g. haptic-control)

In the following sections are proposals for some extensions to the CRSF protocol. These extensions are already in use with my <<CC>> and some 
multi-switch-modules or lighting-modules

=== Proposal for CRSF protocol extensions

==== Binary data (e.g. switch states: on/off)

==== N-ary data (e.g. 2-4bits)

==== Proportional data (e.g. additional channels: >8bit)


== Projects

The following chapters describe some of my active projects. The majority of my former projects (see <<Old.adoc#, Old>> (in german)) are
in a frozen state now. This is due to the fact that I completely shifted the µCs from the AVR-family (DA, DB, tiny1/2) to the more powerful 
STM32-family, mainly the STM32G4xx. These have enough computing resources for the <<sdr>> project, which would have been impossible sticking to 
the AVRs. 

Well, there is one exception: the <<corona>>.

[[corona]]
=== Corona RP8D1 replacement firmware

The `Corona RP8D1` receiver come into several flavors, for the 35MHz band, the 40MHz and the 72MHz band (afaik). 
The reason for giving a substantial amount of time to develop a new firmware for this receiver is the fact that I am
_hoarding_ vintage electronic RC stuff. Unfortunately some of this gear wasn't working anymore. In the process of 
reworking these things I needed a good receiver and I decided to get a scan-receiver without external crystals. But it turns out
that the mostly helpful signal filtering of the `Corona` receiver makes the situation worse if one tries to use these multi-channels
extensions in the transmitters. These encoders produce a time-multiplex over one RC channel, and the correspondant decoder
isn't capable decoding the time multiplex if the receiver modifies / filters the impulse durations. So, the project started ;-) 

There is an extra repositoty https://github.com/wimalopaan/CoronaRP8D1[] for this project.

[[varioprop]]
=== Renewed mainboard for some (old) 27/35/40MHz RC transmitters

tbd

[[sdr]]
=== SDR RC receiver for 27/35/40MHz

My most ambitious project. The origin is also in <<corona>>. The goal is to design a SDR as a I/Q-mixer (tayloe-mixer) with zero-IF and a STM32G431 doing all
the DSP stuff.

Actually, this works for ppm/pcm-modulation in the near field of the transmitter. 

Remaining problems are sensitivity and AGC.

There is no documentation yet.

=== Touch-Screen for the FrSky X12S

In my opinion the `FrSky X12S` is a very well designed and high-quality RC transmitter. Together with https://edgetx.org[EdgeTx] this is unbeatable.
The only drawback is, that it has no touch-screen. I managed to modify https://edgetx.org[EdgeTx] and the hardware to get the same touch-LCD as with the 
RadioMaster TX16S working inside the X12s.

The software modifications are in mainline https://edgetx.org[EdgeTx] (no need to patch or modify) and the hardware modification is described in an extra 
document: {ddir}/rc/touch.html[X12S touch]

Video: https://www.youtube.com/watch?v=BhzwIHQNJnw[Demo]

=== Modification of an old Graupner / JR 40MHz transmitter RF modul for use in e.g. a Radiomaster TX16s / FrSky X12S/X9e or similar

Modern handsets with a JR-like module bay provide a `cppm`-signal and battery-voltage on the pins of the connector. 
Therefore it must be possible to use an old vintage _Graupner JR 40MHz_ quarz transmitter module together with an old 40MHz quarz receiver.

The good news are: yes, it is possible. *But* ...

[CAUTION]
--
It is tempting to place an old 40MHz JR module into the module bay of a modern handset. 

Please: *don't do this!!!*

You can damage your handset!
--

.Some old vintage 40MHz transmitter modules
image::rc/jr_old/mods.jpg[width=240, link="rc/jr_old/mods.jpg"]

.After the modification
image::rc/jr_old/jpt12_3.jpg[width=240, link="rc/jr_old/jpt12_3.jpg"]

For the full story, please follow this link:rc/jr40mhz.html[Howto (german)]

=== Brushed DC-motor controller with sensorless measurement of rotational speed

tbd

==== Version 1: max. 8A / 36V

tbd

==== Version 2: max. 50A / 36V

tbd

[[elrs_jr]]
=== JR-module-bay adapter for ELRS receiver as transmitter

==== Using ELRS receivers as transmitter-modules

Since the differences between ELRS receivers and transmitters (well: both are transceivers and the differences are mostly in transmit-power) are
marginal, one can use every ELRS receiver as a transmitter. Of course, you have to flash a different firmware to it.
See <<elrs_esp8285>> and <<elrs_esp32>> for the correct setting in `expresslrs-configurator`.

[CAUTION]
--
Don't expect the range to be more than 1km. Please test before going to the field (or lake)!
--

[[elrs_esp8285]]
.ELRS firmware selection for ESP8285 based receivers
image::elrs/rx_as_tx.png[width=480]

[[elrs_esp32]]
.ELRS firmware selection for ESP32 based receivers
image::elrs/rx_as_tx2.png[width=480]

==== JR-Module-bay adapter

The communication between the handset and the tranceiver-module inside the JR-module bay takes place over 
`CRSF` / half-duplex serial protocol. The main difficulty here is that for historic reasons the polarity of the 
physical layer is inverted, so the idle level is low (0V) instead of high (3.3V) as normal. The `ESP8285` based boards
aren't capable of processing inverted serial signals. 

The next culprit is that there is no 5V regulated voltage on the pins of the module bay, but the ELRS receiver boad needs
5V regulated voltage.

Due to this fact it would be most convenient to have a adapter, that

* produces the regulated 5V out of the main battery voltage of the handset,
* uninvertes the inverted serial data, and
* splits the half-duplex connection into a seperated full-duplex one.

If you are interested in the pinout of the module bay, see: https://www.expresslrs.org/quick-start/transmitters/tx-prep[pinout]

[[jr_elrs_sch]]
.The schematic (click to view in full-scale)
image::elrs/jr/JR-ELRS_SCH.PNG[width=240, link="elrs/jr/JR-ELRS_SCH.PDF"]

[[jr_elrs_pcb]]
.The PCB (click to view in full-scale)
image::elrs/jr/JR-ELRS_PCB.PNG[width=240, link="elrs/jr/JR-ELRS_PCB.PDF"]


[[jr_elrs_target]]
If you use _Target 3001_ as your EDA: link:elrs/jr/JR-ELRS.T3001[Target 3001 design file].


==== Bill of materials and assembling

tbd

[[elrs_x12s]]
=== Adapter for ELRS receiver as internal XJT/ISRM module for FrSky X12S

If you don't want to use an external ELRS transceiver module e.g. for the JR-bay of your handset, then you may choose to replace the 
internal XJT / ISRM module of the X12S with an ELRS module. 

As mentioned in <<elrs_jr>> it is possible to use (most) ELRS receivers as trasmitters (well: transceiver). The advantage of this approach
is that the ELRS is so tiny, that you can mount it onto the X12S internal daughter boad. Maybe you can also use the antennas of the X12S if
the ELRS is also working at 2.4 GHz. The disadvantage is clearly, that the range is somewhat limited: don't expect it to be more than 1km and 
please make range tests before going to the field or lake.

You can hand-wire all the stuff but much more convenient is a small adapter board as is <<x12s_elrs_sch>> and <<x12s_elrs_pcb>>.

[[x12s_elrs_target]]
If you use _Target 3001_ as your EDA: link:elrs/x12s/X12S_ELRS_Adapter.T3001[Target 3001 design file].


.The Adapter mounted onto the X12S daughter board (click to view in full-scale)
image::elrs/x12s/a.jpg[width=240, link="elrs/x12s/a.jpg"]

.Soldering the ELRS RX-as-TX to the adapter (click to view in full-scale)
image::elrs/x12s/b.jpg[width=240, link="elrs/x12s/b.jpg"]

.Using the antennas (click to view in full-scale)
image::elrs/x12s/c.jpg[width=240, link="elrs/x12s/c.jpg"]

[[x12s_elrs_sch]]
.The schematic (click to view in full-scale)
image:elrs/x12s/X12S_ELRS_Adapter_SCH.PNG[width=240, link="elrs/x12s/X12S_ELRS_Adapter_SCH.PNG"]

[[x12s_elrs_pcb]]
.The PCB (click to view in full-scale)
image:elrs/x12s/X12S_ELRS_Adapter_PCB.PNG[width=240, link="elrs/x12s/X12S_ELRS_Adapter_PCB.PNG"]

[[CC]]
=== The `CruiseController` 

The `CC` (CruiseController) is like a _Flight-Controller_ but mainly for ship/boat-models.

It consists of 

* ELRS receiver
* Bluetooth module
* Servo-PWM-outputs
* SBus(2)/IBus/SumdV3 output
* SBus(2)/S.Port/IBus/Hott telemetry
* 4 direct switching lines (up to 1A@16V) (shared with servo pwm outputs)
* additional serial connections (e.g. GPS)
* V/ESC support
* 16-channel switching mezzanine board
* 16-channel LED mezzanine board

More to come ...

== OpenTx weekly

_OpenTx weekly_ is a https://www.youtube.com/channel/UCedl1hS-dfWh-V4WBz_jGog[YouTube]-channel mostly 
for EdgeTx and OpenTx stuff but also for my above electronic projects. Unfortunately the spoken language is german :-( 

On https://schiffsmodell.blogspot.com/p/grundlagen-zu-opentx.html[Holger Meyer] you may find an up-to-date table of contents.

[[vintage]]
== Vintage RC

=== Graupner / Grundig / JR 

==== Transmitter

.Varioprop Expert Modulsystem FM 6014
image::images/retro/Graupner6014.jpg[]

.Varioprop Graupner Grundig 12S
image::images/retro/Varioprop12S.jpg[]

.Varioprop Graupner Grundig T14 Expert Modulsystem
image::images/retro/Varioprop14_Expert.jpg[]

.Varioprop Graupner Grundig 14S 27MHz
image::images/retro/Varioprop14S_schwarz27.jpg[]

.Varioprop Graupner Grundig 8S 40MHz
image::images/retro/Varioprop8S_schwarz.jpg[]

.Varioprop Graupner Grundig 8S 27MHz
image::images/retro/Varioprop8S.jpg[]

.Varioprop Graupner Grundig C8 27MHz
image::images/retro/VariopropC8.jpg[]

==== Receiver

.Varioprop miniSuperhet FM 40S
image::images/retro/RX01.jpg[]

.Varioprop miniSuperhet 27MHz
image::images/retro/RX02.jpg[]

.Varioprop miniSuperhet FM 35S
image::images/retro/RX03.jpg[]

==== Other

.Varioprop Fahrtregler
image::images/retro/ESC_Varioprop.jpg[]

=== Robbe / Futaba

==== Transmitter

.Robbe digital4
image::images/retro/RobbeDigital4.jpg[]

.Robbe Futaba F-14 Navy 40MHz
image::images/retro/FutabaF14.jpg[]

==== Receiver

==== Other

=== Other

==== Transmitter

==== Receiver

==== Other

.Model Craft Speed Controller
image::images/retro/ESC_Modellcraft.jpg[]

.hitec Speed Controller
image::images/retro/ESC_hitec.jpg[]

== Licence

Please see link:LICENSE[Lizenz], as far as not other licences apply (e.g. in the source code).

== Kontakt

mailto:wilhelm.wm.meier@googlemail.com[email]
